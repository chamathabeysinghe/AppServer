<div class="page-title">
    <h3 class="breadcrumb-header"><%= title %></h3>
</div>
<div class="page-inner full-page" id="school-summary-app">

    <div id="map-canvas"> </div>
    <div id="legend" style="position: absolute;z-index: 10;">
        <h3>School Details</h3>
            <div class="panel panel-white">
                <div class="panel-heading clearfix">
                    <h4 class="panel-title">Projects</h4>
                </div>
                <div class="panel-body">
                    <div class="project-stats">
                        <ul class="list-unstyled">
                            <li>Total Trainees<span class="label label-success pull-right">{{totalTrainees}}</span></li>
                            <li>Total Vehicles<span class="label label-success pull-right">{{totalVehicles}}</span></li>
                            <li>Current Sessions<span class="label label-danger pull-right">{{currentSessions}}</span></li>

                        </ul>
                    </div>
                </div>
            </div>
    </div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCzjeZ1lORVesmjaaFu0EbYeTw84t1_nek"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>

<script>
    $( document ).ready(function() {

        "use strict";

        function initialize() {
            var mapOptions = {
//                6.794934, 79.900564
                center: new google.maps.LatLng(6.794934, 79.900564,6),
                zoom: 17
            };
            var map = new google.maps.Map(document.getElementById('map-canvas'),  mapOptions);
            var trafficLayer = new google.maps.TrafficLayer();
            trafficLayer.setMap(map);

            schoolSummaryApp.loadSummary(map);
        }
        google.maps.event.addDomListener(window, 'load', initialize);
//        schoolSummaryApp.loadSummary();
    });

    $(function () {

        var socket = io();
        socket.emit('authentication', {token: localStorage.getItem('token')});
        socket.on('update',function (msg) {
            console.log(msg);
        })

    })


    var instance = axios.create({
        headers: {'x-access-token': localStorage.getItem('token')}
    });

    var schoolSummaryApp = new Vue({
        el:'#school-summary-app',
        data: {
            totalTrainees:0,
            totalVehicles:0,
            currentSessions:0
        },
        methods:{
            loadSummary:function (map) {
                console.log("Loading Summary");
                instance.get('/users/school-summary').then(function (response) {
                    console.log(response.data);
                    schoolSummaryApp.totalTrainees = response.data.totalTrainees;
                    schoolSummaryApp.totalVehicles = response.data.totalVehicles;
                    schoolSummaryApp.currentSessions = response.data.currentSessions;
                    mapLocations = response.data.mapInfo;
                    for(var i=0;i<mapLocations.length;i+=1){
                        var location = {lat:mapLocations[i].latitude,lng:mapLocations[i].longitude}
                        var contentString = '<div class="panel panel-white stats-widget"><div class="panel-body"><div class="pull-left"><span class="stats-number">58%</span><p class="stats-info">Finished Tasks</p></div><div class="pull-right"><i class="icon-arrow_upward stats-icon"></i></div></div></div>'


                        var infowindow = new google.maps.InfoWindow({
                            content: contentString
                        });




                        var marker = new google.maps.Marker({
                            position: location,
                            map:map
                        })

                        marker.addListener('click', function() {
                            infowindow.open(map, marker);

                        });
                    }
                })
            }
        }
    })

</script>